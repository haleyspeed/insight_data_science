# SubScript

## A web application for subscription services to retain customer loyalty.

As the entertainment software industry moves away from single boxed purchases to a subscription model, subscription services must continually engage their current user base, as well as gain new subscribers, to maintain their subscription volume (and revenue). World of Warcraft is an example of a massively successful subscription service. In 2010, it set the still-unbroken record of 12 million active subscribers, but in the years since, World of Warcraft's parent company, Blizzard Entertainment, as had to continually fight for smaller market share in the wake of increasing competition from games like League of Legends and DOTA2. 

I created SubScript to aid companies like Blizzard retain their subscriber base and subscription volume by identifying disengaged players and targeting them with specific content to bring them back into active status. Subscript then estimates the return on investment if at-risk players were to complete 1-5 additional achievements in the current subscription period. 

_Disclaimer: This is a personal project and not at all associated with the World of Warcraft game or its parent company Blizzard Entertainment._

**For June of 2020, SubScript predicts:**
- 5.4% of the game's population will be at-risk for disengagement from the live game
- Completion of 1-5 additional achievements in the May 2020 will convert 38-55% of at-risk players to active status
- Return on investment for targeting specific content to at-risk players will net $54,000-65,000 USD per 100,000 players per month.



## Datasets
The dataset was self-generated from publicly available data from the World of Warcraft leaderboards and APIs. The training set consisted of 101,000 active characters (logged in within the last 30 days), 38,500 characters at risk of inactivity in the next subscription period (June 2020), and 2,500 inactive players (haven't logged in in at least 8 months). The test sets (one with 40,000 players and one with 120,000 players) retained the same distributions of player groups. Features were 1050 in-game achievements (activities), gear score, and time since login. All achievements were tagged with the completion date and account-wide achievements were excluded due to the recent retroactive account-wide designations.

The dataset underwent three transformation steps that resulted in two output datasets. First the data were analyzed as a time series and were represented as achievements per month. Next, the data were analyzed for content type with dates of completion or binary classification (0 for not completed, 2 for completed). Finally, achievements were aggregated by company-defined categories.

Class labels were determined by time since last login: <= 30 days (0: active), 31 days to 8 months (1: at-risk of inactivity), > 8 months (2: inactive). The final time series dataset was uploaded to a mySQL server for the live app.



## Algorithms

Subscript is built upon two machine learning algorithms with three goals.

1. **Monitor customer engagement** and identify those users at risk for subscription lapse.
2. **Curated content recommendation** based on users' history to keep at-risk users engaged.
3. **Estimate return on investment** for curated content recommendations.

Two random forest classifiers (with class weighting and bootstrapping) were used to predict subscriber engagement in the next subscription period (June 2020): A dataset containing achievements per month and a second with binary classification of achievement completion. Data in the time domain provided the greatest balance of accuracy (86%) and recall for the at-risk group (63%). Random forest performed equally well when active users were classified against inactive users using data in the content domain, but was unable to accurately classify the at-risk group using content-type despite extensive tuning. 

Feature importances generated by the two random forests indicated that the biggest determinants of whether a player will remain active were their gear_score, immediate content completion history (previous 2 months), player versus player activity, and completion of the last expansion features. Heart of Azeroth Level was also indicated, but is a confounding feature as it is used in the calculation of gear score, which is an indirect measure of recent time spent playing the game and time since login. 

Important categories of content type were initially screened with DBSCAN unsupervised clustering with identification of 31 robust clusters. I then quantified category importances using a forward selection wrapper method with the random forest classifier and combined it with the achievement feature importances for a final compilation of 500 achievements popular among active users, but not inactive users. This dataset was uploaded to a mySQL server as the curated recommendations for at-risk users in the live app.


## Validation and Metrics
I generated a second dataset of roughly the same size using the same acquisition and processing steps and trained it from scratch on a random forest and found the same optimization settings as the first set with similar accuracy and recall. When the entire validation set was run on the saved original model, it outperformed the original in both accuracy (90.7%) and recall (0.788) for the at-risk class, indicating that this is a robust, well-fit model for predicting player engagement status.


## First things
**Install the package**
- run `/subscript/setup.py build`
- run `/subscript/setup.py install`

**Note the dependencies for package versions**
- `subscript/subscript/pip_freeze.txt
- scikit-learn was version 0.23 and many changes are slated for 0.24. If you get sklearn errors with 0.24, try the old version.

## Directory Structure
- `notebooks/archive`
- `scripts/archive`
- `subscript/setup.py`
- `subscript/subscript`
- `data` (See the separate ReadMe for the data). Demo files only due to file size limits.


## Executing SubScript
I built and tested the model using the scripts in the `scripts` folder. I then converted the final versions of each script into a series of Jupyter notebooks for easy replication.

- 01_dataset_builder.ipynb 
  - Build main and reference datasets from webscrapes and Blizzard API calls
- 02_exploratory_data_analysis.ipynb 
  - Explore the data, check distributions, and get descriptive stats of the original dataset
- 03_exploratory_data_analysis_validation 
  - I generated a second dataset of roughly the same size 2 weeks later as a validation set
- 04_random_forest_time.ipynb	
  - Classification on the time series dataset
- 05_random_forest_time_validation.ipynb	
  - Validation of the time series model
- 06_dbscan_categories
  - Quick analysis of content categories
- 07_random_forest_features.ipynb		
  - Classification on the content-type dataset 
- 08_forward_feature_selection_categories.ipynb
  - Feature importances on content categories
- 09_random_forest_curated_content.ipynb	
  - Feature importances on content
- 10_MySQL_database_manager.ipynb
  - Database functions for the SubScript mySQL database
11_recommendation_predictor.ipynb
  - Uses the original time series random forest model to determine return on investment for recommended content
  
Â© 2020 GitHub, Inc.
